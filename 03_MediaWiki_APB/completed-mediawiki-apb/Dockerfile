FROM ansibleplaybookbundle/apb-base:canary

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG1lZGlhd2lraS1hcGIKZGVzY3JpcHRpb246IE1lZGlhd2lraSBh\
cGIgaW1wbGVtZW50YXRpb24KYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0\
YToKICBkb2N1bWVudGF0aW9uVXJsOiBodHRwczovL3d3dy5tZWRpYXdpa2kub3JnL3dpa2kvRG9j\
dW1lbnRhdGlvbgogIGxvbmdEZXNjcmlwdGlvbjogQW4gYXBiIHRoYXQgZGVwbG95cyBNZWRpYXdp\
a2kgMS4yMwogIGRpc3BsYXlOYW1lOiBNZWRpYXdpa2kgRGV2Q29uZiAoQVBCKQogIGltYWdlVXJs\
OiBodHRwczovL2RldmNvbmYuY3ovaW1hZ2VzL2ljb24vY3ovZGV2Y29uZi1jei1pY29uLnBuZwpw\
bGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBBbiBBUEIgdGhhdCBkZXBs\
b3lzIE1lZGlhV2lraQogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlO\
YW1lOiBEZWZhdWx0CiAgICAgIGxvbmdEZXNjcmlwdGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYSBz\
aW5nbGUgbWVkaWF3aWtpIGluc3RhbmNlIHdpdGhvdXQgYSBEQgogICAgICBjb3N0OiAkMC4wMAog\
ICAgcGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiBtZWRpYXdpa2lfZGJfc2NoZW1hCiAgICAgICAg\
ZGVmYXVsdDogbWVkaWF3aWtpCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IE1l\
ZGlhd2lraSBEQiBTY2hlbWEKICAgICAgICByZXF1aXJlZDogVHJ1ZQogICAgICAtIG5hbWU6IG1l\
ZGlhd2lraV9zaXRlX25hbWUKICAgICAgICBkZWZhdWx0OiBNZWRpYVdpa2kKICAgICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgICB0aXRsZTogTWVkaWF3aWtpIFNpdGUgTmFtZQogICAgICAgIHJlcXVp\
cmVkOiBUcnVlCiAgICAgIC0gbmFtZTogbWVkaWF3aWtpX3NpdGVfbGFuZwogICAgICAgIGRlZmF1\
bHQ6IGVuCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IE1lZGlhd2lraSBTaXRl\
IExhbmd1YWdlCiAgICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgLSBuYW1lOiBtZWRpYXdpa2lf\
YWRtaW5fdXNlcgogICAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgICAgdGl0bGU6IE1lZGlhd2lraSBBZG1pbiBVc2VyCiAgICAgICAgcmVxdWlyZWQ6IFRydWUK\
ICAgICAgLSBuYW1lOiBtZWRpYXdpa2lfYWRtaW5fcGFzcwogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHRpdGxlOiBNZWRpYXdpa2kgQWRtaW4gVXNlciBQYXNzd29yZAogICAgICAgIHJlcXVp\
cmVkOiBUcnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAo="

ADD playbooks /opt/apb/actions
ADD roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}

USER apb
